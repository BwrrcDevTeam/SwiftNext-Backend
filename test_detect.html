<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测试图片检测</title>
</head>
<body>
    <h2>Console</h2>
    <p id="console"></p>
    <h2>Form</h2>
    <label for="attachment">附件ID</label>
    <input placeholder="附件ID" id="attachment"/>
    <button id="detect" onclick="do_detect()">检测</button>

    <script>
        function log(msg) {
            document.getElementById('console').innerHTML += msg + '<br>';
        }
        function log2(msg) {
            document.getElementById('console2').innerHTML += msg + '<br>';
        }

        function do_detect() {
        //    1. 初始化一个WS
            let ws = new WebSocket('wss://api.imlihe.com/detector/task/ws');
            ws.onopen = function () {
                log('双工连接已建立！');
                log('发送检测请求！');
                let request = {
                    attachment: document.getElementById('attachment').value,
                }
                ws.send(JSON.stringify(request));
            };
            ws.onmessage = function (event) {
                log('收到服务器消息：' + event.data);
            };
            ws.onclose = function () {
                log('双工连接已关闭！');
            };
        }

    </script>
</body>
</html>